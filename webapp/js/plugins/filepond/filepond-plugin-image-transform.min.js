/*
 * FilePondPluginImageTransform 1.0.1
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.FilePondPluginImageTransform=e()}(this,function(){"use strict";var t=function(t){return/^image/.test(t.type)},e=(function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise(function(n,a){var u={key:t,arg:e,resolve:n,reject:a,next:null};i?i=i.next=u:(o=i=u,r(t,e))})}function r(n,o){try{var i=e[n](o),u=i.value;u instanceof t?Promise.resolve(u.value).then(function(t){r("next",t)},function(t){r("throw",t)}):a(i.done?"return":"normal",i.value)}catch(c){a("throw",c)}}function a(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}o=o.next,o?r(o.key,o.arg):i=null}var o,i;this._invoke=n,"function"!=typeof e["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype["throw"]=function(t){return this._invoke("throw",t)},e.prototype["return"]=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}),n={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:[0,1,1,0,0,0],6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},r=function(t,r,a,o){o!==-1&&t.transform.apply(t,e(n[o](r,a)))},a=function(t,e,n){e||(e={x:0,y:0,width:1,height:1});var a=document.createElement("canvas"),o=t.naturalWidth,i=t.naturalHeight;n>=5&&n<=8?(a.width=i,a.height=o):(a.width=o,a.height=i);var u=a.getContext("2d");u.save(),r(u,o,i,n),u.drawImage(t,0,0,o,i),u.restore();var c=u.getImageData(Math.round(e.x*a.width),Math.round(e.y*a.height),Math.round(e.width*a.width),Math.round(e.height*a.height));return c},o=function(t,e){return new Promise(function(n,r){var a=document.createElement("canvas");a.width=t.width,a.height=t.height;var o=a.getContext("2d");o.putImageData(t,0,0),a.toBlob(n,e.type,e.quality)})},i=function(t){var e=void 0;try{e=new ImageData(t.width,t.height)}catch(n){var r=document.createElement("canvas");e=r.getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e},u=function(){function t(t,e){var n=e.mode,r=e.size,a=r.width,o=r.height;if(null===a?a=o:null===o&&(o=a),"force"!==n){var i=a/t.width,u=o/t.height,c=1;"cover"===n?c=Math.max(i,u):"contain"===n&&(c=Math.min(i,u)),a=t.width*c,o=t.height*c}for(var f=t.width,h=t.height,l=Math.round(a),s=Math.round(o),d=t.data,g=new Uint8ClampedArray(l*s*4),m=f/l,v=h/s,p=Math.ceil(m/2),y=Math.ceil(v/2),w=0;w<s;w++)for(var M=0;M<l;M++){for(var _=4*(M+w*l),x=0,T=0,b=0,E=gx_g=gx_b=gx_a=0,A=(w+.5)*v,I=Math.floor(w*v);I<(w+1)*v;I++)for(var O=Math.abs(A-(I+.5))/y,P=(M+.5)*m,R=O*O,U=Math.floor(M*m);U<(M+1)*m;U++){var L=Math.abs(P-(U+.5))/p,j=Math.sqrt(R+L*L);j>=-1&&j<=1&&(x=2*j*j*j-3*j*j+1,x>0&&(L=4*(U+I*f),gx_a+=x*d[L+3],b+=x,d[L+3]<255&&(x=x*d[L+3]/250),E+=x*d[L],gx_g+=x*d[L+1],gx_b+=x*d[L+2],T+=x))}g[_]=E/T,g[_+1]=gx_g/T,g[_+2]=gx_b/T,g[_+3]=gx_a/b}return{data:g,width:l,height:s}}var e={resize:t},n=function(t,n){return t.forEach(function(t){n=e[t.type](n,t.data)}),n},r=function(t,e){var r=n(t.transforms,t.imageData);e(r)};self.onmessage=function(t){r(t.data.message,function(e){self.postMessage({id:t.data.id,message:e},[e.data.buffer])})}};HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var r=this;setTimeout(function(){for(var a=r.toDataURL(e,n).split(",")[1],o=atob(a),i=o.length,u=new Uint8Array(i);i--;)u[i]=o.charCodeAt(i);t(new Blob([u],{type:e||"image/png"}))})}});var c=function(e){var n=e.addFilter,r=e.utils,c=r.Type,f=r.forin,h=r.loadImage,l=r.getFileFromBlob,s=r.getFilenameWithoutExtension,d=r.createWorker,g=function(t,e){var n=s(t),r="image/jpeg"===e?"jpg":e.split("/")[1];return n+"."+r},m=function(t){return"image/jpeg"===t||"image/png"===t?t:"image/jpeg"},v=["resize"];return n("PREPARE_OUTPUT",function(e,n){var r=n.query,c=n.item;return new Promise(function(n,s){if(!t(e)||!r("GET_ALLOW_IMAGE_TRANSFORM"))return n(e);var p=r("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY"),y=null===p?null:p/100,w=r("GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE"),M=c.getMetadata(),_=M.crop,x=[];if(f(c.getMetadata(),function(t,e){v.includes(t)&&x.push({type:t,data:e})}),null===y&&null===w&&!_&&!x.length)return n(e);var T=function(t,r){o(t,r).then(function(t){var r=l(t,g(e.name,m(t.type)));n(r)})["catch"](function(t){console.error(t)})},b=URL.createObjectURL(e);h(b).then(function(t){URL.revokeObjectURL(b);var n=(c.getMetadata("exif")||{}).orientation||-1,r=a(t,_?_.rect:null,n);if(!x.length)return void T(r,{quality:y,type:w||e.type});var o=d(u);o.post({transforms:x,imageData:r},function(t){T(i(t),{quality:y,type:w||e.type}),o.terminate()},[r.data.buffer])})})}),{options:{allowImageTransform:[!0,c.BOOLEAN],imageTransformOutputMimeType:[null,c.STRING],imageTransformOutputQuality:[null,c.INT]}}};return document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:c})),c});
/*
 * FilePondPluginImageCrop 1.0.0
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.FilePondPluginImageCrop=e()}(this,function(){"use strict";var t=function(t){return/^image/.test(t.type)},e=function(t,e){var n=void 0,r=void 0,o=void 0,i=void 0;return t<e?(i=1,r=0,o=i/e*t,n=.5*(1-o)):(o=1,n=0,i=o/t*e,r=.5*(1-i)),{x:n,y:r,height:i,width:o}},n=(function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise(function(n,o){var a={key:t,arg:e,resolve:n,reject:o,next:null};u?u=u.next=a:(i=u=a,r(t,e))})}function r(n,i){try{var u=e[n](i),a=u.value;a instanceof t?Promise.resolve(a.value).then(function(t){r("next",t)},function(t){r("throw",t)}):o(u.done?"return":"normal",u.value)}catch(c){o("throw",c)}}function o(t,e){switch(t){case"return":i.resolve({value:e,done:!0});break;case"throw":i.reject(e);break;default:i.resolve({value:e,done:!1})}i=i.next,i?r(i.key,i.arg):u=null}var i,u;this._invoke=n,"function"!=typeof e["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype["throw"]=function(t){return this._invoke("throw",t)},e.prototype["return"]=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(){function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(c){o=!0,i=c}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()),r=function(t){if("string"==typeof t){var e=t.split(":"),r=n(e,2),o=r[0],i=r[1];return i/o}return t},o=function(n){var o=n.addFilter,i=n.utils,u=i.Type,a=i.loadImage;return o("DID_LOAD_ITEM",function(n,o){var i=o.query;return new Promise(function(o,u){var c=n.file;if(!t(c)||!i("GET_ALLOW_IMAGE_CROP"))return o(n);var f=i("GET_IMAGE_CROP_ASPECT_RATIO");if(null===f)return o(n);var l=r(f),v=URL.createObjectURL(c);a(v).then(function(t){URL.revokeObjectURL(v);var r=t.naturalWidth,i=t.naturalHeight,u=(n.getMetadata("exif")||{}).orientation||-1;if(u>=5&&u<=8){var a=[i,r];r=a[0],i=a[1]}var c=e(i/r,l);n.setMetadata("crop",{rect:c,aspectRatio:l}),o(n)})})}),{options:{allowImageCrop:[!0,u.BOOLEAN],imageCropAspectRatio:[null,u.STRING]}}};return document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:o})),o});